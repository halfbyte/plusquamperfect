<html>
  <head>
    <title>Plusquamperfect</title>
    <meta http-equiv="content-type" value="text/html;charset=utf-8">
  </head>
  
  <style type="text/css">
    #day-list-wrapper {
      overflow: hidden;
      height: 70px;
      
    }
    #day-list { 
      list-style-type: none;
      height: 30px;
      margin:0;
      padding:0;
      float:left;
      display:block;
      overflow: visible;
    }
    #day-list li {
      width: 20px; height: 20px; float: left; display: block; margin:0; padding:5px; 
      text-align:left;
      overflow: visible;
      margin-bottom:40px;
    }
    
    #day-list li span { font-size: 2em; display: block; width: 300px;}
    
  </style>
  
  <script type="text/javascript" src="jquery-1.3.2.min.js"></script>
  <script type="text/javascript">
    var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
    var dates = []
    var playing =false;
    $(document).ready(function(event) {
      $(".date").each( function(i) {
        var dateMatch = this.id.match(/date-(\d{4})-(\d{2})-(\d{2})/);
        var date = new Date(dateMatch[1],dateMatch[2]-1,dateMatch[3]);
        $(this).hide();
        dates[dates.length] = {date: date, id: this.id};
      });
      dates = dates.sort(function(a,b) { return a.date - b.date });
      var firstDate = dates[0].date;
      var lastDate = dates[dates.length-1].date;
      var fullTimeInDays = Math.floor((lastDate - firstDate) / 3600000 / 24);
      console.log(fullTimeInDays);
      $("#day-list-wrapper").append("<ul id='day-list'></ul>");
      for(i=0;i<fullTimeInDays;i++) {
        var thisDay = new Date(dates[0].date - (-3600000 * 24 * i))
        $("#day-list").append("<li>" + thisDay.getDate() + (thisDay.getDate() == 1 ? "<span class='month'>" + months[thisDay.getMonth()] + " " + thisDay.getFullYear() + "</span>" : "")+ "</li>");
      }
      $("#click-prev").click(function(event) {
        move(-1);
        return false;
      });
      $("#click-next").click(function(event) {
        move(1);
        return false;
      });
      
      $("#click-play").click(function(event) {
        playing = !playing;
        return false;
      });
      
      
      function optimizeList() {
        var num = parseInt($('#day-list').css('margin-left')) / 30;
        if ((-num) > 10) {
          var toRemove = (-num) - 10;
          jQuery.each($('#day-list').children().slice(0,toRemove), function(i,v) {$(v).remove()});
          $('#day-list').css('margin-left', '-300px');
        }
      }
      
      function move(dir) {
        var newMargin = (parseInt($("#day-list").css("margin-left")) - (30 * dir)) + "px";
        $("#day-list").animate({ marginLeft: newMargin}, 600, "swing", function(e) {
          optimizeList();
           window.setTimeout(updateAnim, 400);
        } );
        
      }
      
      
      
      function updateAnim() {
        if(playing) {
          move(1);
        } else window.setTimeout(updateAnim, 1000);
      }     
      window.setTimeout(updateAnim, 1000);
      
      
    });
    
    
    
  </script>

  <body>

    <div id="day-list-wrapper"></div>
    
    <a href="#" id="click-prev">zur√ºck</a>
    <a href="#" id="click-play">play/pause</a>
    <a href="#" id="click-next">vor</a>

    <div class="date" id="date-2008-12-31">
      <h2>Last day of year!</h2>
    </div>
    <div class="date" id="date-2009-01-01">
      <h2>First day of year!</h2>
    </div>
    <div class="date" id="date-2008-06-17">
      <h2>First day of year!</h2>
    </div>
    
    
  </body>


</html>
